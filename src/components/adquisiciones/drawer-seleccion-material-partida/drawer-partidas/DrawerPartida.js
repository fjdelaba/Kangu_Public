export default {
  name: 'DrawerPartida',
  data() {
    return {
      search: null,
      caseSensitive: false,
      items: [
        {
          'children': [
            {
              'id': 22,
              'name': 'Mo Directa',
              'par_id': 14,
              '__depth': 1
            },
            {
              'id': 23,
              'name': 'Mo Indirecta',
              'par_id': 14,
              '__depth': 1
            }
          ],
          'id': 14,
          'name': 'MANO OBRA',
          'par_id': 0,
          '__depth': 0
        },
        {
          'children': [
            {
              'id': 25,
              'name': 'Obras Previas',
              'par_id': 15,
              '__depth': 1
            },
            {
              'id': 26,
              'name': 'Impermeabilización, sellos',
              'par_id': 15,
              '__depth': 1
            },
            {
              'id': 27,
              'name': 'EEMM, PINTURA INTM',
              'par_id': 15,
              '__depth': 1
            },
            {
              'id': 28,
              'name': 'Cubierta, Hojalatería',
              'par_id': 15,
              '__depth': 1
            },
            {
              'id': 29,
              'name': 'Demoliciones, Retiros',
              'par_id': 15,
              '__depth': 1
            },
            {
              'id': 30,
              'name': 'Revoques, Pinturas',
              'par_id': 15,
              '__depth': 1
            },
            {
              'id': 31,
              'name': 'Pavimentos,  pintura pavimento',
              'par_id': 15,
              '__depth': 1
            },
            {
              'id': 32,
              'name': 'Tabiques, Cielos',
              'par_id': 15,
              '__depth': 1
            },
            {
              'id': 33,
              'name': 'Puertas, portones',
              'par_id': 15,
              '__depth': 1
            },
            {
              'id': 34,
              'name': 'Cristales',
              'par_id': 15,
              '__depth': 1
            },
            {
              'id': 35,
              'name': 'Rejas',
              'par_id': 15,
              '__depth': 1
            },
            {
              'id': 36,
              'name': 'Accesorios Baños',
              'par_id': 15,
              '__depth': 1
            },
            {
              'id': 37,
              'name': 'Cortinas metalicas antifuego',
              'par_id': 15,
              '__depth': 1
            },
            {
              'id': 38,
              'name': 'Defensas bajas',
              'par_id': 15,
              '__depth': 1
            },
            {
              'id': 39,
              'name': 'Seguridad y Prevención',
              'par_id': 15,
              '__depth': 1
            },
            {
              'id': 40,
              'name': 'Instalaciones',
              'par_id': 15,
              '__depth': 1
            },
            {
              'id': 41,
              'name': 'Otros',
              'par_id': 15,
              '__depth': 1
            }
          ],
          'id': 15,
          'name': 'MATERIALES',
          'par_id': 0,
          '__depth': 0
        },
        {
          'children': [
            {
              'id': 42,
              'name': 'Obras Previas',
              'par_id': 16,
              '__depth': 1
            },
            {
              'id': 43,
              'name': 'Impermeabilización, sellos',
              'par_id': 16,
              '__depth': 1
            },
            {
              'id': 44,
              'name': 'EEMM, PINTURA INTM',
              'par_id': 16,
              '__depth': 1
            },
            {
              'id': 45,
              'name': 'Cubierta, Hojalatería',
              'par_id': 16,
              '__depth': 1
            },
            {
              'id': 46,
              'name': 'Demoliciones, Retiros',
              'par_id': 16,
              '__depth': 1
            },
            {
              'id': 47,
              'name': 'Revoques, Pinturas',
              'par_id': 16,
              '__depth': 1
            },
            {
              'id': 48,
              'name': 'Pavimentos,  pintura pavimento',
              'par_id': 16,
              '__depth': 1
            },
            {
              'id': 49,
              'name': 'Tabiques, Cielos',
              'par_id': 16,
              '__depth': 1
            },
            {
              'id': 50,
              'name': 'Puertas, portones',
              'par_id': 16,
              '__depth': 1
            },
            {
              'id': 51,
              'name': 'Cristales',
              'par_id': 16,
              '__depth': 1
            },
            {
              'id': 52,
              'name': 'Rejas',
              'par_id': 16,
              '__depth': 1
            },
            {
              'id': 53,
              'name': 'Accesorios Baños',
              'par_id': 16,
              '__depth': 1
            },
            {
              'id': 54,
              'name': 'Cortinas metalicas antifuego',
              'par_id': 16,
              '__depth': 1
            },
            {
              'id': 55,
              'name': 'Defensas bajas',
              'par_id': 16,
              '__depth': 1
            },
            {
              'id': 56,
              'name': 'Seguridad y Prevención',
              'par_id': 16,
              '__depth': 1
            },
            {
              'children': [
                {
                  'id': 59,
                  'name': 'Sanitario',
                  'par_id': 57,
                  '__depth': 2
                },
                {
                  'id': 60,
                  'name': 'PCI',
                  'par_id': 57,
                  '__depth': 2
                },
                {
                  'id': 61,
                  'name': 'Eléctricas',
                  'par_id': 57,
                  '__depth': 2
                },
                {
                  'id': 62,
                  'name': 'Climatización',
                  'par_id': 57,
                  '__depth': 2
                },
                {
                  'id': 63,
                  'name': 'Aire Comprimido',
                  'par_id': 57,
                  '__depth': 2
                },
                {
                  'id': 64,
                  'name': 'CCDD',
                  'par_id': 57,
                  '__depth': 2
                },
                {
                  'id': 65,
                  'name': 'CCTV, SEGURIDAD',
                  'par_id': 57,
                  '__depth': 2
                },
                {
                  'id': 66,
                  'name': 'Otras instalaciones',
                  'par_id': 57,
                  '__depth': 2
                }
              ],
              'id': 57,
              'name': 'Instalaciones',
              'par_id': 16,
              '__depth': 1
            },
            {
              'id': 58,
              'name': 'Otros Subcontratos',
              'par_id': 16,
              '__depth': 1
            }
          ],
          'id': 16,
          'name': 'SUBCONTRATOS',
          'par_id': 0,
          '__depth': 0
        },
        {
          'children': [
            {
              'id': 67,
              'name': 'Traslados',
              'par_id': 17,
              '__depth': 1
            },
            {
              'id': 68,
              'name': 'Maquinaria',
              'par_id': 17,
              '__depth': 1
            },
            {
              'id': 69,
              'name': 'Arriendos',
              'par_id': 17,
              '__depth': 1
            },
            {
              'id': 70,
              'name': 'Retiro escombros',
              'par_id': 17,
              '__depth': 1
            }
          ],
          'id': 17,
          'name': 'TRASLADOS Y ARRIENDOS',
          'par_id': 0,
          '__depth': 0
        },
        {
          'children': [
            {
              'id': 71,
              'name': 'Boletas, Seguros',
              'par_id': 18,
              '__depth': 1
            },
            {
              'id': 72,
              'name': 'Otros GG',
              'par_id': 18,
              '__depth': 1
            }
          ],
          'id': 18,
          'name': 'VARIOS',
          'par_id': 0,
          '__depth': 0
        }
      ],
      open: [1, 2],
      selPartida: null
    }
  },
  props: {
    _origen:{
      Type: Number, // 1 = agregar, 2 = editar
      default: 0
    },
    _edicionPartida:{
      Type: Function
    },
    _seleccionPartida:{
      Type: Function
    }
  },
  mounted() {
    this.cargarPartidas()
  },
  computed: {
    filter () {
      return this.caseSensitive
        ? (item, search, textKey) => item[textKey].indexOf(search) > -1
        : undefined
    },
    seleccionMultiple() {
      return this._origen === 2
    },
    openCacheTree() {
      return this.$refs.reftreeviewpartida.openCache
    }
  },
  methods: {
    async cargarPartidas() {
      try {
        console.log('adasd')
        // const { data } = await this.axios.get('https://mindicador.cl/api')    
        const datos = {
          pro_fk: 94
        }

        console.log('datos: ', datos)
        const { data: { partidas } } = await this.axios.post('https://actions-kangu-hasura.herokuapp.com/getPartidas', datos)   

        console.log('resp: ', partidas)
        this.listaPartidas = partidas
      } catch (e) {
        console.log(e)
      } 
    },
    seleccionPartida(partida) {
      console.log('this.origen: ', this._origen)
      console.log('Partida: ', partida)
      if (this._origen === 1) {
        partida[0].cantidad = 0
        this.selPartida = partida
        this.search = null
        console.log(this.$refs.reftreeviewpartida)
        this.$refs.reftreeviewpartida.updateAll(false)
        this._seleccionPartida(partida)
      }
      if (this._origen === 2) {
        console.log('this.$refs.reftreeviewpartida: ', this.$refs.reftreeviewpartida)
        this._edicionPartida(partida)
      }
    },
    cerrarNodosAbiertos(nodos) {
      console.log('nodos: ', nodos)
    },
    seleccionProrateoPartida(item) {
      console.log('item: ', item)
      item.seleccionado = true
    }
  }
}